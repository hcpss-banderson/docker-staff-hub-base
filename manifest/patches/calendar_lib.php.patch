# This patch file was generated by NetBeans IDE
# It uses platform neutral UTF-8 encoding and \n newlines.
--- HEAD
+++ Modified In Working Tree
@@ -1641,7 +1641,9 @@
         // Get the midnight of the day the event will end.
         $usermidnightend = usergetmidnight($endtime);
         // Check if we will still be on the same day.
-        if ($usermidnightstart == $usermidnightend) {
+        //HCPSS Mod or (($usermidnightend - $usermidnightstart) == DAYSECS)) added to correct all day
+        if (($usermidnightstart == $usermidnightend) or (($usermidnightend - $usermidnightstart) == DAYSECS)) {
+            //End HCPSS Mod
             // Check if we are running all day.
             if ($event->timeduration == DAYSECS) {
                 $time = get_string('allday', 'calendar');
@@ -1671,6 +1673,30 @@
             }
             $timeend = calendar_time_representation($event->timestart + $event->timeduration);
 
+            // HCPSS mod - This section is inserted to correct the issue where a
+            // multi-day all day event adds an extra day in list view. For
+            // example, an event which runs from Monday through Wednesday and is
+            // all day would look like this: Mon, 12:00 AM - Thu, 12:00 AM. We
+            // want it to be like: Mon, All day - Thu, All day.
+            
+            // Does the event start at midnight?
+            $startsatmidnight = $usermidnightstart - $starttime === 0;
+            
+            // Does the event end at midnight
+            $endsatmidnight = $usermidnightend - $endtime === 0;
+            
+            if($startsatmidnight && $endsatmidnight){
+              // This event starts and ends at midnight. In my book, that
+              // makes it an all day event.
+              $timestart = get_string('allday', 'calendar');
+              $timeend = get_string('allday', 'calendar');
+              
+              // Subtract 1 from the endtime so that the end day-of-week
+              // displays properly (Wed instead of Thu in our example).
+              $dayend = calendar_day_representation($event->timestart + $event->timeduration - 1, $now, $usecommonwords) . ', ';
+            }            
+            //End HCPSS mod
+            
             // Set printable representation.
             if ($now >= $usermidnightstart && $now < strtotime('+1 day', $usermidnightstart)) {
                 $url = calendar_get_link_href(new moodle_url(CALENDAR_URL . 'view.php', $linkparams), 0, 0, 0, $endtime);
